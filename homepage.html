<!DOCTYPE html>
<html lang="en">
    <head>
        <title>StudentFoodPlaner</title>
            <meta charset='utf-8'/>
            <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
            <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
            <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js'></script>
            <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
            
    </head>
    
    <body>
        <header>
            <h1>StudentFoodPlaner</h1>
        </header>
        
            <div class="search_function">
                <label for="search">Search for recipes:</label>
                <input type="text" id="search" name="search">
                <button id="search-btn">Search</button>
                <ul id="recipelist"></ul>

                
                    <script>
                        $(document).ready(function() {
                            $('#search-btn').click(function() {
                                var query = $('#search').val();
                                $.ajax({
                                    url: 'https://spoonacular-recipe-food-nutrition-v1.p.rapidapi.com/recipes/search',
                                    type: 'GET',
                                    dataType: 'json',
                                    contentType: 'application/json',
                                    headers: {
                                        'X-RapidAPI-Key': '6328442dbemsh528bbb036e41048p1c68e9jsna9b1d1b2afad',
                                        'X-RapidAPI-Host': 'spoonacular-recipe-food-nutrition-v1.p.rapidapi.com'
                                    },
                                    data: {
                                        query: query
                                    },
                                    success: function (data) {
                                        var tempString = '';
                                        $.each(data.results, function(index, value) {
                                            tempString += '<li class="recipe" data-title="' + value.title + '" data-id="' + value.id + '">' + value.title + '</li>';                                        })
                                        $("#recipelist").html(tempString);
                                        $(".recipe").draggable({
                                            helper: 'clone'
                                        } );
                                    },
                                    error: function (xhr, ajaxOptions, thrownError) {
                                        alert('Error: ' + xhr.status + '   ' + thrownError);
                                    }
                                });
                            });
                        });
                    </script>
            </div>
            
        <div id="calendar"></div> 
        <script> 
            document.addEventListener('DOMContentLoaded', function() {
                    var calendarEl = document.getElementById('calendar');
                    var calendar = new FullCalendar.Calendar(calendarEl, {
                        timeZone: 'UTC',
                        initialView: 'dayGridMonth',
                        editable: true,
                        selectable: true,
                        droppable:true,
                        weekNumbers:true,
                        eventClick: function(info) {
                            if (confirm("Are you sure you want to delete this event?")) {
                                info.event.remove();
                            }
                        }
                    });
                       
                    

                calendar.render();
                    var Draggable = FullCalendar.Draggable;
                    var containerEl = document.getElementById('recipelist');

                    // Initialisierung der externen Events bestehend aus den Rezepten

                    new Draggable(containerEl, {
                        itemSelector: '.recipe',
                        eventData: function(recipeEl) {
                        return {
                            title: recipeEl.innerText
                        };
                        }
                    });
                    const eventsArray = [];

                        // Eine Schleife verwenden, um die Rückgabewerte der Funktion in das Array aufzunehmen
                        for (let i = 1; i <= 5; i++) {
                        eventsArray.getEvents();
                        }

                        // Das Array mit den Veranstaltungen anzeigen
                        console.log(eventsArray);
                                            
            });
            
        </script>
        
        </script>
        <div id="shoppinglist">
            <ul id="list"></ul>
        </div>
                <script>
                    (function getShoppingList() {
                        $.ajax({
                                        url: 'https://hidden-sierra-69971-16d83e153d07.herokuapp.com/api/v1.0/shoppinglist',
                                        type: 'GET',
                                        dataType: 'json',
                                        contentType: 'application/json',
                                        success: function (data) {
                                            tempString = '';
                                            $.each(data.ingredients, function(index, value) {
                                                tempString += '<li>' + value.name +  ' quant. : '
                                                            + value.quantity + '</li>';
                                            })
                                            $("#list").html(tempString);
                                        },
                                        error: function (xhr, ajaxOptions, thrownError) {
                                        alert('Error: ' + xhr.status + '   ' + thrownError);
                                    }
                            });
                    })();
                </script>
    </body>
    <footer>
        <p> © 2023 Senid, Anton and Marvin</p>
    </footer>

</html>